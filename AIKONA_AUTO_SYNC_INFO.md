# Автоматическая синхронизация с Айконой

## Что настроено

Автоматическая синхронизация данных из API Айконы настроена на **7:00 утра каждый день** (московское время).

## Как это работает

1. **Cron Job** запускается каждый день в 7:00 утра (МСК)
2. Система автоматически проходит по всем объектам, у которых указан `aikonaObjectId`
3. Для каждого объекта синхронизируются данные из Айконы:
   - Находятся соответствующие СТК по названиям СМР
   - Подсчитываются выполненные локации (SZCompletion === 100)
   - Обновляется поле `total` для каждого СМР
4. Все изменения сохраняются в базу данных

## Логирование

В логах сервера вы увидите:
- `[Aikona Auto-Sync] Начало автоматической синхронизации в ...`
- Для каждого успешно синхронизированного объекта: `[Aikona Auto-Sync] Объект "название" успешно синхронизирован`
- `[Aikona Auto-Sync] Синхронизация завершена. Успешно: X, Ошибок: Y`
- Ошибки синхронизации (если есть)

## Ручная синхронизация

Кнопка "Забрать данные" в модальном окне объекта остается активной и позволяет синхронизировать данные вручную в любое время.

## Установка зависимостей

После добавления `node-cron` в `package.json`, нужно установить зависимости:

```bash
cd backend
npm install
```

## Настройка времени

Время синхронизации настраивается в файле `backend/server.js`:

```javascript
cron.schedule('0 0 7 * * *', async () => {
    // Синхронизация
}, {
    scheduled: true,
    timezone: "Europe/Moscow"
});
```

Формат: `'0 0 7 * * *'` = секунда минута час день месяц день_недели
- Можно изменить час (сейчас 7) на любое значение от 0 до 23

## Проверка работы

После установки зависимостей и перезапуска сервера, в консоли вы увидите:
```
[Cron] Автоматическая синхронизация с Айконой настроена на 7:00 каждый день (МСК)
```

Утром в 7:00 в логах появятся сообщения о синхронизации.

